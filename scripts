# scripts/generate_synthetic.py
import numpy as np
import pandas as pd
from datetime import datetime
import os

np.random.seed(42)
os.makedirs("data/raw", exist_ok=True)

N = 300
baseline_cost = np.random.uniform(50, 300, N)
baseline_duration = np.random.randint(6, 36, N)

soil_quality = np.random.choice(['good','moderate','poor'], size=N, p=[0.4,0.4,0.2])
contractor_reliability = np.clip(np.random.beta(5,2, size=N), 0.1, 0.99)
supply_delay_rate = np.random.poisson(1.2, size=N)
design_change_rate = np.random.beta(2,6, size=N)
weather_risk_index = np.random.uniform(0,1, size=N)

soil_num = np.array([0 if s=='good' else (1 if s=='moderate' else 2) for s in soil_quality])
theta0 = 0.05; theta_soil = 0.12; theta_contractor = -0.8
theta_supply = 0.15; theta_design = 0.9; theta_weather = 0.6

log_mult = (theta0
            + theta_soil * soil_num
            + theta_contractor * (1 - contractor_reliability)
            + theta_supply * supply_delay_rate
            + theta_design * design_change_rate
            + theta_weather * weather_risk_index
           )
noise = np.random.normal(0, 0.25, size=N)
cost_multiplier = np.exp(log_mult + noise)
final_cost = baseline_cost * cost_multiplier
duration_multiplier = 1 + 0.1*soil_num + 0.2*(1-contractor_reliability) + 0.1*supply_delay_rate + 0.3*design_change_rate + 0.2*weather_risk_index
final_duration = np.round(baseline_duration * duration_multiplier).astype(int)

df = pd.DataFrame({
    'project_id': [f"P{1000+i}" for i in range(N)],
    'baseline_cost_millions': np.round(baseline_cost, 2),
    'baseline_duration_months': baseline_duration,
    'soil_quality': soil_quality,
    'contractor_reliability': np.round(contractor_reliability, 3),
    'supply_delay_rate': supply_delay_rate,
    'design_change_rate': np.round(design_change_rate, 3),
    'weather_risk_index': np.round(weather_risk_index, 3),
    'cost_multiplier': np.round(cost_multiplier, 3),
    'final_cost_millions': np.round(final_cost, 2),
    'final_duration_months': final_duration
})
df.to_csv("data/raw/synthetic_projects.csv", index=False)
print("Synthetic data written to data/raw/synthetic_projects.csv")

